
### 問題1：前年との比較

```sql
SELECT
sale AS "current_sale",
SUM(sale) OVER(ORDER BY year RANGE BETWEEN 1 PRECEDING AND 1 PRECEDING) AS "pre_sale"
FROM Sales;
```

---

### 問題2：累計の計算

```sql
SELECT shohin_mei, hanbai_tanka, shohin_bunrui,
AVG(hanbai_tanka) OVER(PARTITION BY shohin_bunrui) AS "avg_tanka"
FROM Shouhin;
```

---

### 問題3：重複期間の検出

```sql
結合ver

SELECT
A.reserver,
A.start_date,
A.end_date
FROM
Reservations AS A
JOIN
Reservations AS B
ON
A.reserver <> B.reserver -- 自分自身との比較を除外
AND A.start_date <= B.end_date
AND A.end_date >= B.start_date;

ウインド関数ver１１

SELECT DISTINCT reserver, start_date, end_date
FROM (
SELECT
reserver,
start_date,
end_date,
MAX(end_date) OVER(ORDER BY start_date ROWS BETWEEN 1 PRECEDING AND 1 PRECEDING) AS prev_end_date
FROM
Reservations
) AS T
WHERE
start_date < prev_end_date;
```