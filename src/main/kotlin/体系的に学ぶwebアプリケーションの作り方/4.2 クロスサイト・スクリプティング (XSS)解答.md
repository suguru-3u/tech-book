
## 問題 1
### 解答 1

* **反射型XSS (Reflected XSS):**
  ユーザーからの入力データがサーバーサイドで処理され、適切にエスケープされずにHTTPレスポンスに即座に「反射」されてブラウザに返されることで発生します。
　データはサーバーに保存されません。攻撃者は、悪意のあるスクリプトを埋め込んだURLをユーザーにクリックさせることで、そのユーザーのブラウザ上でスクリプトを実行させます。主な攻撃手法として、フィッシングメールやSNSなどを通じた悪意あるURLの誘導があります。

* **蓄積型XSS (Stored XSS):**
  攻撃者が入力した悪意のあるスクリプト（ペイロード）がWebアプリケーションのデータベースやファイルシステムなどに永続的に「蓄積」され、そのデータが他のユーザーに表示される際に、そのユーザーのブラウザ上でスクリプトが実行されることで発生します。掲示板の投稿、コメント、プロフィール情報などが典型的な脆弱箇所です。一度スクリプトが蓄積されると、そのコンテンツを閲覧した不特定多数のユーザーが攻撃対象となります。

* **DOM Based XSS:**
  サーバーサイドとの通信を介さず、クライアントサイドのJavaScriptが、ブラウザのDOM (Document Object Model) を操作する際に発生します。具体的には、URLのハッシュフラグメントやクライアントサイドのストレージ（LocalStorageなど）から取得したデータなど、信頼できない入力値がJavaScriptによって直接HTML構造に組み込まれる際に、悪意のあるスクリプトが実行されてしまいます。攻撃は、ユーザーが特定のURLにアクセスすることで、そのブラウザのJavaScriptによって引き起こされます。

## 問題 2
### 解答 2

最も基本的な対策は、**HTMLエスケープ処理を徹底すること**です。

**具体的な方法:**
ユーザーから入力された文字列や外部から取得したデータをHTMLとして表示する際、HTML特殊文字（例: `<`、`>`、`&`、`"`、`'`）を対応するHTMLエンティティ（例: `&lt;`、`&gt;`、`&amp;`、`&quot;`、`&#39;`または`&apos;`）に変換することです。これにより、入力されたスクリプトコードがブラウザによってHTMLとして解釈されず、単なる文字列として表示されるため、スクリプトの実行を防ぐことができます。

## 問題 3
### 解答 3

XSS攻撃によってCookieが窃取されることを防ぐために、Cookieに対して**`HttpOnly`属性**を設定することが推奨されます。

**具体的な効果:**
`HttpOnly`属性が設定されたCookieは、クライアントサイドのJavaScriptからアクセスすることができなくなります。これにより、もしXSS攻撃が成功し、悪意のあるスクリプトが実行されたとしても、`document.cookie`のようなJavaScriptのAPIを通じて攻撃者がユーザーのセッションCookieなどの重要な情報を盗み出すことを防ぐことができます。CookieはHTTPリクエストでのみサーバーに送信され、JavaScriptからは保護されます。

## 問題 4
### 解答 4

DOM Based XSSがサーバーサイドの処理を介さずにクライアントサイドのみで発生する理由は、このタイプのXSSが**ブラウザのDOM（Document Object Model）操作とJavaScriptの特性に依存している**ためです。

従来の反射型や蓄積型XSSでは、サーバーがユーザー入力を適切にエスケープせずにHTMLレスポンスを生成し、それをブラウザに送信することで脆弱性が生じます。しかし、DOM Based XSSでは、Webページに含まれるJavaScriptコードが、URLのハッシュフラグメント（`window.location.hash`）や`document.referrer`、クライアントサイドのストレージ（`localStorage`、`sessionStorage`）、あるいは特定の入力フィールドの値など、**ブラウザ上で直接アクセス可能な入力ソースから取得したデータを、適切にサニタイズ（無害化）せずにDOMに直接挿入する**（例: `element.innerHTML = userInput;` や `document.write(userInput);`）ことで発生します。

この場合、サーバーは悪意のあるスクリプトをHTMLとして出力しておらず、単に脆弱なJavaScriptコードを含むHTMLページを配信しているだけです。攻撃は、ユーザーのブラウザがページをロードし、その脆弱なJavaScriptが実行され、DOMが書き換えられることで成立します。したがって、攻撃の発生はサーバー側の処理とは独立して、完全にクライアントサイドで完結します。

## 問題 5

XSS対策として、HTMLエスケープ処理以外にもWebアプリケーション側で実装できるセキュリティヘッダーがあります。そのヘッダーの名称と、XSS対策における役割について説明してください。

### 解答 5

XSS対策としてHTMLエスケープ処理以外に実装できるセキュリティヘッダーの一つに**`X-XSS-Protection`ヘッダー**があります。

**役割:**
`X-XSS-Protection`ヘッダーは、主要なWebブラウザに組み込まれているXSSフィルタリング機能を制御するためのものです。このヘッダーを設定することで、ブラウザに対してXSSフィルタリングを有効にするよう指示し、反射型XSS攻撃などを検知・ブロックする手助けをします。

* **`X-XSS-Protection: 1; mode=block`** のように設定することで、XSS攻撃と疑われるスクリプトをブラウザが検知した場合、ページのレンダリングをブロックし、スクリプトの実行を防ぐことができます。

ただし、`X-XSS-Protection`ヘッダーはすべてのXSS攻撃を防ぐものではなく、ブラウザの実装に依存するため、根本的な対策（適切なエスケープ処理やContent Security Policy (CSP) など）と組み合わせて使用することが重要です。